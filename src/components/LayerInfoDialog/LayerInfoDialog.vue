<template>
  <v-dialog
    scrollable
    :value="open"
    width="600"
    @click:outside="close"
  >
    <v-card>
      <v-app-bar class="pr-1 pl-2" flat>
        <v-toolbar-title>
          {{ title }}
        </v-toolbar-title>

        <v-spacer />

        <v-btn icon @click="close">
          <v-icon>mdi-close</v-icon>
        </v-btn>
      </v-app-bar>

      <v-divider />


  
      
      <div class="px-2 py-2 flex-grow-1 overflow-y-auto">
        <v-card-text>
          <div 
            v-for="(htmlFactsheet, index) in htmlFactsheets" 
            :key="index" 
            class="px-2 py-2 flex-grow-1 overflow-y-auto"
          >
            <div v-html="htmlFactsheet" />
          </div>

          <dl class="layer-info-dialog__metadata">
            <div v-for="item in content" :key="item.key">
              <dt class="font-weight-bold">
                {{ item.key }}
              </dt>
              <dd v-html="item.value" />
            </div>
            <div>
              <dt class="font-weight-bold">
                {{ $t('shareUrl') }}
                <v-btn icon @click="copyUrlToClipboard">
                  <v-icon>mdi-clipboard-arrow-down-outline</v-icon>
                </v-btn>
              </dt>
              <dd>
                <v-text-field
                  ref="share"
                  :value="shareUrl"
                />
              </dd>
            </div>
          </dl>
        </v-card-text>
      </div>
    </v-card>
  </v-dialog>
</template>

<script>
  export default {
    props: {
      open: {
        type: Boolean,
        default: false,
      },
      title: {
        type: String,
        default: '',
      },
      factsheets: {
        type: Array,
        default: () => [],
      },
      content: {
        type: Array,
        default: () => [],
      },
      shareUrl: {
        type: String,
        default: '',
      },
    },
    data() {
      return {
        htmlFactsheets: [],
      }
    },
    async mounted() {
      for (const factsheet of this.factsheets) {
        const html = await fetch(`https://kaartenbak.netlify.app/api/factsheet?id=${ factsheet.id }&format=html`)
          .then(res => res.text())
        this.htmlFactsheets.push(html)
      }
    },
    methods: {
      close() {
        this.$emit('close')
      },
      copyUrlToClipboard() {
        navigator.clipboard.writeText(this.shareUrl)
        alert(`The following url is copied to clipboard! ${ this.shareUrl }`)
      },
    },
  }
</script>

<style lang="scss">
.layer-info-dialog__metadata {
  display: grid;
  grid-template-columns: auto 1fr;
  row-gap: $spacing-smaller;
  column-gap: $spacing-default;
}

.layer-info-dialog__metadata div {
  display: contents;
}
</style>
